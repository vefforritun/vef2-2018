# Fyrirlestur 11.1

## Webpack

### Vefforritun 2 ‚Äî HBV403G

#### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

* Webpack er nota√∞ til a√∞ √æ√Ω√∞a JavaScript modules
* Leysir √∫r dependencies og safnar √∂llum _notu√∞um_ k√≥√∞a √≠ eitt _bundle_
  - B√¶√∞i okkar eigin og √∫r NPM p√∂kkum
* Ekki bara k√≥√∞i! Getur l√≠ka s√©√∞ um CSS, myndir og allskonar

***

* Getum nota√∞ `import` og `require` √≠ k√≥√∞a sem mun keyra √° client
  - Webpack s√©r um a√∞ _transpilea_ fyrir okkur √æ.a. virki √≠ √∂llum v√∂frum
* Uppsetning
  - `npm install --save-dev webpack webpack-cli`

***

## src og dist

* √ûurfum a√∞ a√∞greina √° milli k√≥√∞a og t√∫lkunar fr√° webpack
* Geymum k√≥√∞a √≠ `src/` og t√∫lkun √≠ `build/` e√∞a `dist/`

***

## Bundle

* Bundle er JavaScript skr√° sem inniheldur inngangspunkt √≠ forriti√∞ okkar
* _Bootstrap_ k√≥√∞i fr√° webpack og s√≠√∞an allur nota√∞ur k√≥√∞i √≠ forriti
* Oft eitt bundle en l√≠ka h√¶gt a√∞ skipta upp me√∞ _code-splitting_

***

## Webpack zero config

Fr√° og me√∞ webpack 4 √æarf ekki a√∞ skilgreina config skr√°

* Skr√°um `"build": "webpack"` `script` √≠ `package.json` og k√≥√∞a √≠ `src/`
  - F√°um √∫t _production_ √∫tg√°fu af bundle √≠ `dist/main.js`
* Skr√°um `"dev": "webpack --mode development"` `script`
  - F√°um √∫t _development_ √∫tg√°fu √≠ `dist/main.js`

***

## mode

* `mode` er n√Ω stilling √≠ webpack 4 sem segir til um hvort webpack eigi vi√∞ bundle
* Stillum me√∞ `production`, `development` e√∞a `none`
* Sj√°lfgefi√∞ er `mode: 'production'`

***

## Webpack config

* √ûegar vi√∞ notum webpack setjum vi√∞ yfirleitt upp einhverjar reglur um hvernig √æa√∞ √° a√∞ virka
* S√∂fnum saman √≠ `webpack.config.js`
  - nafn er venja, ekki krafa
* Keyrum me√∞ `webpack --config webpack.config.js` gegnum npm script
* webpack config skr√° er keyr√∞ af node og ver√∞um √æv√≠ a√∞ nota `require` √æar

***

## webpack.config.js

```javascript
const path = require('path');

module.exports = {
  mode: 'development',
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  }
};
```

***

## entry

* [`entry`](https://webpack.js.org/concepts/entry-points) er inngangspunktur e√∞a inngangspunktar √≠ forrit
  - Sj√°lfgefi√∞ gildi er `src/`
* Webpack finnur dependencies √∫tfr√° √æeim og √∫tb√Ωr _dependency graph_

***

* Getum skilgreint sem
  - `string`, sl√≥√∞ √° eina inngangspunktinn
  - `object`, lyklar skilgreina mismunandi inngangspunkta sem mun hver √∫tb√∫a s√©rstakt dependency graph
  - `array`, fylki af strengjum og/e√∞a hlutum

***

## output

* [`output`](https://webpack.js.org/concepts/output/) skilgreinir hvar bundles eru b√∫nir til
  - Sj√°lfgefi√∞ gildi er `dist/`
* Skilgreinum sem hlut me√∞
  - `filename`, nafn √° bundle, t.d. `bundle.js`
  - `path`, absolute sl√≥√∞ √° m√∂ppu sem skrifa √° √≠
* Ef vi√∞ h√∂fum marga inngangspunkta √æurfum vi√∞ a√∞ skilgreina `filename` me√∞ [_substitution_](https://webpack.js.org/configuration/output/#output-filename), t.d. `[name].js`

***

```javascript
const path = require('path');

module.exports = {
  mode: 'development',
  entry: {
    a: './src/a.js',
    b: './src/b.js',
  },
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname, 'dist')
  }
};
```

***

## NPM pakkar

* Vi√∞ getum s√≥tt NPM pakka og v√≠sa√∞ √≠ √æ√° √∫r forritum og webpack mun skilja og b√¶ta vi√∞ bundle
* Stundum eru √æessir pakkar mj√∂g st√≥rir, √æurfum a√∞ passa upp √° a√∞ forriti√∞ okkar bl√°si ekki √∫t
* Webpack hefur _tree shaking_ reiknirit sem reynir a√∞ losa √≠ burtu √≥nota√∞an k√≥√∞a
  - Fer eftir p√∂kkum hvort √æa√∞ virki r√©tt, √æarf a√∞ passa, t.d. fyrir `lodash`

***

## Loaders

* Me√∞ [_loaders_](https://webpack.js.org/concepts/loaders/) getum vi√∞ l√°ti√∞ webpack virka me√∞ fleiri skr√°m en bara JavaScript
* Loader breytir skr√° √≠ m√≥dul sem webpack skilur og getur sett √≠ dependency graph
  - Getum gert `import 'styles.css'` sem annars er √≥skilgreind heg√∞un
* Loader er skilgreindur √≠ hlut me√∞ `test` og `use` lykla

***

## Loaders ‚Äì test

* [`test`](https://webpack.js.org/configuration/module/#condition) segir til um hvort skr√° eigi a√∞ vera me√∞h√∂ndlu√∞ af √æessum loader e√∞a ekki
* `string` fyrir n√°kv√¶ma sl√≥√∞
* `RegExp` fyrir t.d. allar `css` skr√°r, `test: /\.css$/`
* `array` fyrir m√∂rg tilvik
* `function` og `object` l√≠ka stutt
* Ef vi√∞ viljum sleppa e√∞a a√∞eins leita √° √°kve√∞num st√∂√∞um getum vi√∞ sett `include` og `exclude` lykla √° loader

***

## Loaders ‚Äì use

* [`use`](https://webpack.js.org/configuration/module/#rule-use) skilgreinir loader e√∞a loadera sem nota √°, skilgreinum s√≠√∞an me√∞
* `string` ef vi√∞ v√≠sum beint √≠ loader
* `object` ef vi√∞ viljum stilla frekar, setjum √æ√° loader √≠ `'loader'`, stillingar √≠ `'options'`

***

* `array` ef vi√∞ viljum a√∞ fleiri en einn loader keyri, keyra √≠ skilgreindri r√∂√∞
* Vi√∞ notum ekki `require` e√∞a `import` √° loader, ef b√∫i√∞ er a√∞ s√¶kja loader √≠ NPM er h√¶gt a√∞ v√≠sa √≠ hann √≠ config
  - `npm install --save-dev style-loader` og v√≠sum √≠ me√∞ `'style-loader'`

***

```javascript
module: {
  rules: [
    {
      test: /\.css$/,
      include: './src',
      use: [
        'style-loader',
        { loader: 'css-loader', options: {} },
      ],
    }
  ]
}
```

***

## CSS

* [`style-loader`](https://github.com/webpack-contrib/style-loader) s√©r um a√∞ t√∫lka CSS og skj√≥ta inn st√≠lum √≠ `<style>`
* [`css-loader`](https://github.com/webpack-contrib/css-loader) t√∫lkar `import`, `@import`, `url()` o.√æ.h.
* Ef vi√∞ viljum setja CSS √≠ s√©r skr√° getum vi√∞ nota√∞ a√∞ra loadera
  - [`extract-text-webpack-plugin`](https://github.com/webpack-contrib/extract-text-webpack-plugin) fyrir webpack 3 og fyrri
  - [`mini-css-extract-plugin`](https://github.com/webpack-contrib/mini-css-extract-plugin) fyrir webpack 4

***

## File-loader

* [`file-loader`](https://github.com/webpack-contrib/file-loader) leyfir okkur a√∞ s√¶kja skr√°r og nota
* S√¶kir skr√° og setur √≠ `output` m√∂ppu me√∞ hash nafni og vi√∞eigandi endingu
  - t.d. `/src/file.png` ver√∞ur `/dist/0dcbbaa7013869e351f.png`
* Getum nota√∞ fyrir allskonar skr√°r, sj√° [Webpack: Asset Management](https://webpack.js.org/guides/asset-management/)

***

## Plugins

* Plugins eru lei√∞ til a√∞ auka vi√∞ virkni webpack
* Skr√°um √≠ fylki undir `plugins`
* Geta √°tt vi√∞ hluti √° √∂llum stigum ferils
* [Webpack teymi heldur √∫ti slatta](https://webpack.js.org/plugins/) og miki√∞ til √° NPM

***

## HtmlWebpackPlugin

* [HtmlWebpackPlugin](https://github.com/jantimon/html-webpack-plugin) √∫tb√Ωr `index.html` skr√° fyrir okkur
* V√≠sar r√©tt √≠ √æ√° bundles sem b√∫nir eru til
* Getum l√≠ka skaffa√∞ template og _injecta√∞_ √≠ √æa√∞

***

## clean-webpack-plugin

* [clean-webpack-plugin](https://github.com/johnagan/clean-webpack-plugin) s√©r um a√∞ hreinsa `dist/`
* Hreinsar allt √∫t √∫r m√∂ppu √°√∞ur en vi√∞ buildum
* √Ütti ekkert a√∞ vera √æar inni sem ekki ver√∞ur til √≠ build skrefi

***

```javascript
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const CleanWebpackPlugin = require('clean-webpack-plugin');
module.exports = {
  mode: 'production',
  entry: './src/index.js',
  plugins: [
    new CleanWebpackPlugin(['dist']),
    new HtmlWebpackPlugin()
  ],
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, 'dist')
  }
};
```

***

## Webpack og √ær√≥un

* Webpack hefur t√≥l til a√∞ hj√°lpa okkur vi√∞ √ær√≥un
* Source maps geta veri√∞ stillt me√∞ `devtool`
  - [Margir m√∂guleikar](https://webpack.js.org/configuration/devtool/) fr√° √æv√≠ a√∞ gefa miklar uppl√Ωsingar yfir √≠ a√∞ vera hr√∂√∞
* Ef vi√∞ keyrum `webpack --watch` fylgist webpack me√∞ √∂llum skr√°m √≠ dependency graph og rebuildar ef eitthva√∞ breytist

***

## webpack-dev-server

* `webpack-dev-server` tekur √æetta einu skrefi lengra og b√Ωr til vef√æj√≥n sem endurhle√∞ur s√≠√∞u eftir rebuild
* [Miki√∞ af stillingum...](https://webpack.js.org/configuration/dev-server/)
* Keyrum upp gegnum npm script:
  - `"dev": "webpack-dev-server --open"`
* Keyrir allt √≠ minni svo vi√∞ sj√°um hluti ekki ver√∞a til √≠ `dist/`

---

![Eject!](img/eject.jpg)

***

## Eject

* √ûegar vi√∞ keyrum `npm run eject` √≠ `create-react-app` verkefni eru √∂ll config f√¶r√∞ √≠ r√≥t verkefnis
* `src/` mappa er l√°tin vera
* Notar webpack en l√≠ka s√©rsm√≠√∞u√∞ script til a√∞ gera upplifun betri
* Mj√∂g g√≥√∞ar athugasemdir √≠ k√≥√∞a sem er alveg √æess vir√∞i a√∞ lesa √≠ gegnum til a√∞ l√¶ra betur √°

---

## N√¶stu skref √≠ React

* Server-side rendering
  - Hvernig getum vi√∞ skrifa√∞ √∫t HTML √° server?
* Hot reloading √° components
* Code-splitting
  - Hva√∞ gerist √æegar verkefni√∞ ver√∞ur st√¶rra?
* Margt, margt fleira

---

## Starter kits

* N√≥g til af √∂√∞rum starter kits
  - React teymi [heldur √∫ti lista](https://reactjs.org/community/starter-kits.html)
* [Next.js](https://learnnextjs.com/) byggir √° √æv√≠ a√∞ server rendera fr√° byrjun
* [Ueno starter kit](https://github.com/ueno-llc/starter-kit-universally/) üôà
