# Fyrirlestur 8.2

## React #1

## Vefforritun 2 ‚Äî HBV403G

### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## Sagan

* Fr√° √æv√≠ a√∞ [‚ÄûWeb 2.0‚Äú](https://en.wikipedia.org/wiki/Web_2.0) var skilgreint 2004 hafa vefir veri√∞ a√∞ ver√∞a fl√≥knari
* jQuery og √∂nnur DOM tengd library komu kringum 2005 og hj√°lpu√∞u vi√∞ a√∞ sm√≠√∞a cross-browser vefi
* St√¶rri ‚Äûframework‚Äú til a√∞ skrifa vefi komu fram, t.d. Dojo, ExtJs
* [Backbone.js](http://backbonejs.org/) kom √≠ kringum 2010, library til a√∞ tengja vef og API

***

* [AngularJS](https://angularjs.org/) kom einnig kringum 2010 sem framework til a√∞ b√∫a til ‚Äûsingle page applications‚Äú
* [Polymer](https://www.polymer-project.org/) byrja√∞i sem polyfill fyrir _web components_, W3C sta√∞al sem hefur veri√∞ lengi √≠ vinnslu og h√¶gt og r√≥lega fengi√∞ meiri stu√∞ning √≠ v√∂frum
* [Ember.js](http://emberjs.com/) ...
* [Vue.js](https://vuejs.org/) ...
* React ...

***

## Single page application

* Single page application e√∞a _SPA_ eru vefforrit sem, eftir fyrsta load, framkv√¶ma aldrei ‚Äûrefresh‚Äú
* Vefur hagar s√©r meira einsog desktop forrit
* F√°um n√Ω g√∂gn fr√° vef√æj√≥n me√∞ Ajax e√∞a √°l√≠ka

---

## React!

***

```javascript
export default class Toggle extends Component {
  state = { toggled: true }

  handleClick = () => {
    this.setState(prev => ({
      toggled: !prev.toggled
    }));
  }

  render() {
    return (
      <button onClick={this.handleClick}>
        {this.state.toggled ? 'ON' : 'OFF'}
      </button>
    );
  }
}
```

***

## Grunnhugmynd React

* React byggir √° √æv√≠ a√∞ a√∞skilna√∞ur milli markup √≠ formi template m√°la og l√≥g√≠kar (JavaScript) s√© √≥r√∂kr√©ttur
  - Template m√°l hafa √∂√∞ruv√≠si, ekki jafn kr√∂ftugan syntax
* Markup og l√≥g√≠k eru √≠ e√∞li s√≠nu tengd saman og √æessi a√∞skilna√∞ur byggir _√° t√¶kni_

***

## React

* Highly cohesive
  - Hver hluti inniheldur lang flest sem √æarf til birtingar og notkunar
* Loosely coupled
  - Hver hluti er sj√°lfum s√©r n√¶gur og √æarf ekki a√∞ra hluti

---

## React og JavaScript

* M√¶lt me√∞ a√∞ nota ES6/2015 me√∞ React
* `import` og `export` √≠ sta√∞inn fyrir `require` og `module.exports`
* `babel` nota√∞ til a√∞ transpile'a

***

## Starter kits

* M√∂rg, _m√∂rg_, t√¶ki og t√≥l sem eru notu√∞ vi√∞ √ær√≥un √° react verkefnum
  - webpack, react, babel, eslint, redux, stylelint, sass, postcss, o.fl.
* Opinionated
  - Sass er best! Nei Less!
* Unopinionated
  - Leysir grunnverkefni en tiltekur ekki √°kve√∞in t√≥l

***

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Marc was almost ready to implement his &quot;hello world&quot; React app <a href="https://t.co/ptdg4yteF1">pic.twitter.com/ptdg4yteF1</a></p>&mdash; Thomas Fuchs ü§¶‚Äç‚ôÇÔ∏è (@thomasfuchs) <a href="https://twitter.com/thomasfuchs/status/708675139253174273?ref_src=twsrc%5Etfw">March 12, 2016</a></blockquote>

<script src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

***

## [create react app](https://github.com/facebook/create-react-app)

* Starter kit fyrir react sem er vi√∞haldi√∞ af react teymi
* ‚ÄûZero config‚Äú
* Felur allar fl√¶kjur
* Unopinionated
* Mj√∂g g√≥√∞ur sta√∞ur til a√∞ byrja √°

***

## create react app

* Munum nota √≠ okkar verkefnum
* [Margar uppskriftir](https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md) til a√∞ b√¶ta vi√∞ auka t√≥lum
* Getum s√≠√∞an ‚Äûsloppi√∞‚Äú fr√° create react app me√∞ `npm run eject`
  - F√¶rir √∂ll dependency, t√≥l og build ferli inn √≠ project

***

## create react app ‚Äì uppsetning

```bash
> npx create-react-app my-app
> cd my-app
> npm start
```

***

## create react app t√≥l

* √ûegar vi√∞ keyrum f√°um vi√∞:
  - l√°gmarks linting
  - hot reload ‚ú®
* √ñll verkefni munu **a√∞eins** keyra √° client
  - Sko√∞um e.t.v. server-side rendering (SSR) ef t√≠mi gefst

***

## [React DevTools](https://github.com/facebook/react-devtools)

* Extension fyrir [Chrome](https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi) og [Firefox](https://addons.mozilla.org/firefox/addon/react-devtools/)
* Leyfir okkur a√∞ sko√∞a _componenta_, _prop_ og _state_

***

## Developer experience

* Ein af meginreglum vi√∞ √ær√≥un √° React er a√∞ forritun s√© unun
  - G√≥√∞ skj√∂lun
  - G√≥√∞ villuskilabo√∞
* Auka hlutir sem eru _n√¶s_
  - L√°ti√∞ vita af algengnum innsl√°ttarvillum
  - Validation √° DOM tr√©
  - o.fl.

---

## JSX

* JSX er vi√∞b√≥t vi√∞ JavaScript sem leyfir okkur a√∞ l√Ωsa vi√∞m√≥ti
* Blandar saman HTML elementum, React componentum og JavaScript
* üò±

***

## JSX tr√©

* Myndar _tr√©_ einsog DOM
  - JSX m√° hrei√∞ra
* Element sem byrja √° st√≥rum staf eru **React element**
* Element sem byrja √° litlum staf eru t√∫lku√∞ sem DOM element
* √ñll lauf tr√©s eru DOM element

***

* Vefjum JSX yfirleitt √≠ `()` til a√∞ koma √≠ vef fyrir automatic semicolon insertion
* Innan `{}` √≠ JSX getum vi√∞ sett JavaScript seg√∞ir
  - `(<p>Testing {[1, 2, 3].join(', ')}</p>)`
* JSX er l√≠ka t√∫lka√∞ sem seg√∞
  - `return (<h1>Hello world!</h1>);`

***

* Element √≠ JSX geta √°tt attribute
  - Skrifu√∞ me√∞ camelCase
  - `{}` fyrir expression, `""` fyrir strengi
  - Fr√≠standandi attribute (√°n gildis) er t√∫lka√∞ sem `true`
  - `class` er fr√°teki√∞ or√∞ √≠ JavaScript og notum √æv√≠ `className` ‚ùóÔ∏è

***

* √ñll gildi sem t√∫lku√∞ eru √≠ JSX eru _escaped_, verndar fyrir XSS
* Getum nota√∞ self-closing syntax √∫r XML/XHTML
* `(<img src={img.url} className="image" />)`
* `(<MyInput required />)`

***

## JSX t√∫lka√∞

* JSX er _syntactic sugar_ fyrir kall √≠ `React.createElement`
* Eftir √æ√Ω√∞ingu ver√∞a allar JSX seg√∞ir endurkv√¶mt k√∂ll √≠ √æa√∞
* Til √æess a√∞ JSX virki yfirh√∂fu√∞ √æarf a√∞ vera b√∫i√∞ a√∞ `import`a React:
  - `import React from 'react'`

***

```javascript
const element = (
  <h1 className="greeting">
    <span>Hello, world!</span>
  </h1>
);
```

```javascript
const element = React.createElement(
  "h1",
  { className: "greeting" },
  React.createElement(
    "span",
    null,
    "Hello, world!"
  )
);
```

---

## Declarative API

* React hefur _declarative API_
  - Einsog HTML
* Vi√∞ segjum hvernig vi√∞ viljum a√∞ UI s√© og react passar upp√° a√∞ √æa√∞ passi
* √ìl√≠kt _imperative_ API √æar sem vi√∞ framkv√¶mum skref-fyrir-skref √æa√∞ sem √æarf til a√∞ UI s√© r√©tt

***

## React element og DOM

* √ûar sem JSX element eru ekki DOM element er t√∂luvert √≥d√Ωrara a√∞ b√∫a √æau til
  - √ûar til a√∞ √° einhverjum t√≠mapunkti sem vi√∞ b√∫um til DOM element √≠ raun
* Til a√∞ b√∫a til DOM tr√© k√∂llum vi√∞ √≠ fall fr√° ReactDOM og gefum r√≥t tr√©s √°samt DOM n√≥√∞u sem mun innihalda ni√∞urst√∂√∞u, oft n√≥√∞a me√∞ `id` `root`
  - `ReactDOM.render(element, document.getElementById('root'));`

***

## Uppf√¶rsla √≠ DOM

* Ef eitthva√∞ l√¶tur `element` breytast, e√∞a ef vi√∞ k√∂llum aftur √≠ `render` mun React _a√∞eins uppf√¶ra_ √æa√∞ sem breyttist
* React heldur utan um ‚Äûvirtual DOM‚Äú (VDOM) sem er sta√∞a √° UI geymd √≠ minni sem er s√≠√∞an syncu√∞ vi√∞ alv√∂ru DOM
  - √ûetta sync er kalla√∞ [reconciliation](https://reactjs.org/docs/reconciliation.html)

***

* √ötg√°fa 16 af react [breytir √∫tf√¶rslu](https://code.facebook.com/posts/1716776591680069/react-16-a-look-inside-an-api-compatible-rewrite-of-our-frontend-ui-library/) √∫r √æv√≠ a√∞ vera sync √≠ a√∞ vera async (kalla√∞ ‚ÄûFiber‚Äú)
* Uppf√¶rsla mun eiga s√©r sta√∞ ef kalla√∞ er aftur √≠ `render` e√∞a ef √° einhverjum t√≠mapunkti, √≠ einhverju component er kalla√∞ √° `setState` en √æa√∞ mun uppf√¶ra hluttr√© fr√° √æeim component

***

## Reconciliation

* ‚ÄûDiff‚Äú sem er keyrt √° vdom og dom og uppf√¶rir **a√∞eins √æa√∞ sem √æarf a√∞ breyta** til a√∞ l√°ta passa
* Bestu reiknirit til a√∞ breyta einu tr√© √≠ anna√∞ kosta √≠ kringum O(n¬≥) svo React √æarf a√∞ stytta s√©r lei√∞
  - √ñllu hluttr√© er hent ef foreldri breytist
  - Fyrir lista af hlutum √¶tti forritari a√∞ l√°ta vita hvort breytingar hafi √°tt s√©r sta√∞ me√∞ `key` attribute, gefum lista _stable id_

***

## Reconciliation reiknirit

1. React b√Ωr til n√Ωtt VDOM
2. diffar vi√∞ gamla
3. √ötb√Ωr minnsta sett af DOM a√∞ger√∞um til a√∞ breyta √° milli
4. Framkv√¶mir a√∞ger√∞ir

---

## Components

* Me√∞ √æv√≠ a√∞ nota components getum vi√∞ skipt vi√∞m√≥tinu okkar upp √≠ sj√°lfst√¶√∞ar einingar
  - Mj√∂g g√≥√∞ p√¶ling sem virkar afskaplega vel √≠ prax√≠s
* Getum hugsa√∞ um component einsog JavaScript fall: tekur vi√∞ `props` (properties) sem hlut me√∞ g√∂gnum og skilar React element(s)

***

* H√¶gt a√∞ skilgreina me√∞ `function`, √æ√° kalla√∞ _functional component_, sem skilar elements me√∞ `return`
* E√∞a `class`, skilar elements √≠ gegnum `return` √° `render()` falli
* Ef vi√∞ notum React element √≠ JSX eru attribute send inn sem prop
  - √ûegar element tekur m√∂rg attribute er gott a√∞ setja hvert og eitt √≠ s√©r l√≠nu

***

```javascript
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}
```

```javascript
class Welcome extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>;
  }
}

const element = <Welcome name="Sara" />;
```

```html
<h1>Hello, Sara</h1>
```

***

```javascript
(
  <Welcome title="Velkomin" subtitle="Gaman" color="green" size="large" />
)
// vs.
(
  <Welcome
    title="Velkomin"
    subtitle="Gaman"
    color="green"
    size="large"
  />
)
```

***

## Skilagildi componenta

* Component geta skila√∞:
  - Elements, JSX seg√∞
  - Fylki af elements, JSX seg√∞um
  - `falsy` gildi ‚Äì ekkert ver√∞ur skrifa√∞ √≠ DOM

***

```javascript
function FooBar(props) {
  return [
    <p>foo</p>,
    <p>bar</p>,
  ];
}
```

***

## Fylki √≠ componentum

* Vi√∞ getum unni√∞ me√∞ fylki √≠ componentum og √≠tra√∞ √∫t gildum √æeirra √≠ element
* React mun kvarta yfir √æv√≠ a√∞ √æa√∞ vanti _key_
  - Fl√Ωtilei√∞ fyrir React til a√∞ rendera hra√∞ar
* √Üttum a√∞ setja sem sannanlega einstakt gildi
  - Ef vi√∞ getum ekki er h√¶gt a√∞ nota `index` fylkis

***

```javascript
const numbers = [1, 2, 3, 4, 5];
const listItems = numbers.map((number) =>
  <li key={number.toString()}>
    {number}
  </li>
)
```

***

## Fragments

* Stundum viljum vi√∞ skila m√∂rgum elementum
* Getum skila√∞ _fragment_ sem √∫tb√Ωr ekki element
  - `<React.Fragment>foo</React.Fragment>`
* Ef vi√∞ skilum fragment √≠ √≠trun ver√∞um vi√∞ a√∞ skilgreina `key`

***

```javascript
function Table(props) {
  return (
    <table>
      <tr>
        <Columns />
      </tr>
    </table>
  );
}

function Columns(props) {
  return (
    <React.Fragment>
      <td>Foo</td>
      <td>Bar</td>
    </React.Fragment>
  );
}
```

***

## Component

* _Ekkert_ sem stoppar okkur √≠ √æv√≠ a√∞ nota sama component aftur og aftur
* Afskaplega handh√¶gt og eykur endurn√Ωtingu
* Component getur innihaldi√∞ component sem inniheldur component sem ... o.s.fr.

***

* √Üttum a√∞ skipta UI upp √≠ fleiri, minni components
  - Algeng mist√∂k √≠ byrjun er a√∞ skrifa of st√≥r component
* Ef or√∞i√∞ fl√≥ki√∞ ‚Äì b√∫a til n√Ωtt component

***

## App component

* Algengt pattern er a√∞ hafa eitt `App` ‚Äûyfir‚Äú component sem r√≥t fyrir UI
  - Tekur ekki inn nein `props`
* Stillir og setur upp hluti og s√©r um `routing`

***

```javascript
function App() {
  return (
    <main>
      <Welcome name="world" />
      <Welcome name="foo" />
    </main>
  );
}
```

---

## Conditional Rendering

* Stundum viljum vi√∞ st√Ωra √æv√≠ hva√∞ er rendera√∞ eftir √æv√≠ √≠ hva√∞a st√∂√∞u component er
* Getum:
  - Nota√∞ fl√¶√∞ist√Ωringar √≠ `render`
  - Geymt element √≠ breytu
  - Nota√∞ `&&` (√∫taf short-circuiting)
  - Nota√∞ ternary virkjan `? :`

***

```javascript
function Greeting(props) {
  const isLoggedIn = props.isLoggedIn;
  if (isLoggedIn) {
    return <UserGreeting />;
  }
  return <GuestGreeting />;
}
```

***

```javascript
class Login extends React.Component {
  render() {
    if (this.props.isLoggedIn) {
      button = <LogoutButton />;
    } else {
      button = <LoginButton />;
    }

    return (
      <div>
        <Greeting isLoggedIn={isLoggedIn} />
        {button}
      </div>
    )
  }
}
```

***

```javascript
function Mailbox(props) {
  const unreadMessages = props.unreadMessages;
  return (
    <div>
      <h1>Hello!</h1>
      {unreadMessages.length > 0 &&
        <h2>
          {unreadMessages.length} unread messages.
        </h2>
      }
    </div>
  );
}
```

***

```javascript
function LoggedIn(props) {
  const isLoggedIn = props.isLoggedIn;
  return (
    <div>
      The user is
      <b>{isLoggedIn ? 'currently' : 'not'}</b>
      logged in.
    </div>
  );
}
```

---

## Props

* React components √¶ttu a√∞ vera hrein f√∂ll m.t.t. props
  - Aldrei breyta props, √æau eru read-only
* √ûegar vi√∞ breg√∞umst vi√∞ breytingum √≠ UI notum vi√∞ _state_
* `children` er s√©rstakt prop sem inniheldur _b√∂rn_ elements, ef einhver

***

## children

* `children` geta veri√∞ sett sem mismunandi gagnat√∂g
  - `undefined` ef engin b√∂rn
  - `string` ef texti
  - `object` ef eitt barn sem er element
  - `array` ef fleiri en eitt barn sem er element

***

Getur veri√∞ bras a√∞ athuga t√Ωpu en React b√≠√∞ur upp √° [`React.Children`](https://reactjs.org/docs/react-api.html#reactchildren) hj√°lparf√∂ll

```javascript
function Childrens(props) {
  const { children } = props;
  const childrenAsArray =
    React.Children.toArray(children);

  return (
    <div>
      <p>{React.Children.count(children)} b√∂rn</p>
      {React.Children
        .map(children, child => child)
      }
    </div>
  );
}
```

***

## propTypes

* Eftir √æv√≠ sem vi√∞ skrifum fleiri components og setjum √æau saman aukast l√≠kur √° b√∂ggum
* React hefur stu√∞ning vi√∞ [`prop-types`](https://github.com/facebook/prop-types) sem keyrir _type check_ √° runtime √≠ √ær√≥un
* Skilgreinum sem `propTypes` hlut √° `function` e√∞a `class`
  - Hver lykill √≠ hlut √° vi√∞ eitt prop, gildi lykils er ger√∞ sem prop √¶tti a√∞ vera

***

* [Miki√∞ af mismumandi t√Ωpum og a√∞fer√∞um](https://github.com/facebook/prop-types#usage) til a√∞ skilgreina
* Ef vi√∞ endum √° `isRequired` mun React senda vi√∞v√∂run ef gildi er ekki sent inn √≠ component
* Notum helst
  - `node`, hva√∞ sem h√¶gt er a√∞ birta
  - JavaScript t√Ωpur: `array`, `bool`, `func`, `number`, `object`
  - Listar af hlutum, `oneOf` og `oneOfType`, `arrayOf`
  - Hlutur af √°kve√∞nu formi, `shape({})` √æar sem hlutur er propTypes hlutur
  - [o.fl.](https://github.com/facebook/prop-types#usage)

***

```javascript
import PropTypes from 'prop-types';

Comp.propTypes = {
  title: PropTypes.isRequired,
  type: PropTypes.oneOf(['foo', 'bar']),
  user: PropTypes.shape({
    name: PropTypes.string,
    age: PropTypes.number,
  }),
  onClick: PropTypes.func,
}
```

***

## defaultProps

* √Åsamt `propTypes` getum vi√∞ skilgreint sj√°lfgefin gildi me√∞ `defaultProps`
* Getum √æ.a. passa√∞ upp √° a√∞ f√° alltaf einhver gildi √≠ props
  - Type check er keyrt eftir a√∞ `defaultProp` eru sett
* √Üttum ekki a√∞ skilgreina ef vi√∞ notum `isRequired`

***

```javascript
Comp.defaultProps = {
  type: 'foo',
  user: null,
  onClick: () => {},
}
```

***

## propTypes og defaultProps √° class

Ef vi√∞ h√∂fum r√©tta stillingar √° babel (t.d. [`transform-class-properties`](https://babeljs.io/docs/plugins/transform-class-properties/)) getum vi√∞ sett `propTypes` og `defaultProps` sem `static` breytur √° class

```javascript
class Person extends Component {
  static propTypes = {
    name: PropTypes.string,
  }

  static defaultProps = {
    name: 'NN',
  }
  //...
}
```

---

## N√°nar

* Yfirfer√∞ byggir √° [react docs](https://reactjs.org/docs/hello-world.html)
* [Pete Hunt: React: Rethinking best practices -- JSConf EU 2013](https://www.youtube.com/watch?v=x7cQ3mrcKaY)
* [WTF is JSX](https://jasonformat.com/wtf-is-jsx/)
